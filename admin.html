<!DOCTYPE html>
<html lang="tr">
<script>
    // Yönetici şifresi kontrolü
    const sifre = prompt("Yönetici şifresini girin:");
    if (sifre !== "bekged2025") {
        alert("Hatalı şifre!");
        window.location.href = "/"; // Ana sayfaya yönlendir
    }
</script>

<head>
    <meta charset="UTF-8" />
    <title>Yönetim Paneli</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f0f0f0;
            max-width: 800px;
            /* Genişletildi */
            margin: auto;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #0077a6;
            margin-bottom: 2rem;
        }

        .form-grup {
            background: white;
            padding: 1.5rem;
            /* Biraz daha boşluk */
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            /* Daha belirgin gölge */
            transition: all 0.3s ease;
            /* Hover efekti için */
        }

        .form-grup:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        label {
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            /* Etiket ile input arasına boşluk */
            font-weight: bold;
            color: #555;
        }

        input[type="text"],
        input[type="date"],
        select,
        textarea {
            width: calc(100% - 20px);
            /* Padding'i hesaba kat */
            padding: 0.8rem 10px;
            /* Daha fazla padding */
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
            /* Padding ve border genişliğe dahil */
            margin-bottom: 1rem;
            /* Input'lar arasına boşluk */
        }

        textarea {
            min-height: 100px;
            /* Min yükseklik */
            resize: vertical;
            /* Sadece dikey yeniden boyutlandırma */
        }

        button {
            background-color: #0077a6;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1rem;
        }

        button:hover {
            background-color: #005f85;
            transform: translateY(-2px);
            /* Hafif yukarı kayma efekti */
        }

        button.sil-buton {
            background-color: #dc3545;
            /* Kırmızı */
            float: right;
            margin-left: 10px;
            /* Liste öğeleri arasına boşluk */
        }

        button.sil-buton:hover {
            background-color: #c82333;
        }

        .mesaj-kutusu {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none;
            /* Varsayılan olarak gizli */
        }

        .mesaj-kutusu.basari {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .mesaj-kutusu.hata {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        ul li {
            background: #fff;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            /* Küçük ekranlarda sarmalama */
        }

        ul li span {
            flex-grow: 1;
            padding-right: 10px;
            /* Butondan uzaklık */
            font-size: 0.95rem;
            color: #444;
        }

        ul li small {
            display: block;
            font-size: 0.8rem;
            color: #777;
            margin-top: 5px;
        }

        ul li img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            vertical-align: middle;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <h1>Yönetim Paneli</h1>

    <div id="mesaj-kutusu" class="mesaj-kutusu"></div>

    <div class="form-grup">
        <h2>Ana Sayfa Metni</h2>
        <label for="anasayfa-metin">Metin:</label>
        <textarea id="anasayfa-metin"></textarea>
        <button onclick="anasayfaMetniGuncelle()">Kaydet</button>
    </div>

    <div class="form-grup">
        <h2>Duyuru Ekle</h2>
        <label for="duyuru-baslik">Başlık:</label>
        <input type="text" id="duyuru-baslik" />
        <label for="duyuru-tarih">Tarih:</label>
        <input type="date" id="duyuru-tarih" />
        <label for="duyuru-detay">Detay:</label>
        <textarea id="duyuru-detay"></textarea>
        <button onclick="duyuruEkle()">Duyuru Ekle</button>
    </div>

    <div class="form-grup">
        <h2>Mevcut Duyurular</h2>
        <ul id="duyuru-listesi">
        </ul>
    </div>

    <div class="form-grup">
        <h2>Proje Ekle</h2>
        <label for="proje-baslik">Başlık:</label>
        <input type="text" id="proje-baslik" />
        <label for="proje-detay">Detay:</label>
        <textarea id="proje-detay"></textarea>
        <label for="proje-tur">Tür:</label>
        <select id="proje-tur">
            <option value="devam">Devam Eden</option>
            <option value="tamam">Tamamlanan</option>
            <option value="basvuruya-acik">Başvuruya Açık</option>
        </select>
        <label for="proje-basvuru-link">Başvuru Linki (isteğe bağlı):</label>
        <input type="text" id="proje-basvuru-link" />
        <button onclick="projeEkle()">Proje Ekle</button>
    </div>

    <div class="form-grup">
        <h2>Mevcut Projeler</h2>
        <ul id="proje-listesi">
        </ul>
    </div>

    <div class="form-grup">
        <h2>Galeriye Görsel Ekle</h2>
        <label for="gorsel-url">Görsel URL:</label>
        <input type="text" id="gorsel-url" placeholder="Görselin doğrudan bağlantısı" />
        <label for="gorsel-aciklama">Açıklama (isteğe bağlı):</label>
        <textarea id="gorsel-aciklama"></textarea>
        <button onclick="gorselEkle()">Görsel Ekle</button>
    </div>

    <div class="form-grup">
        <h2>Mevcut Görseller</h2>
        <ul id="galeri-listesi">
        </ul>
    </div>

    <script>
        const API_BASE_URL = window.location.origin; // Sunucunun adresini dinamik olarak alır

        // Mesaj gösterme fonksiyonu
        function showMessage(message, isError = false) {
            const mesajKutusu = document.getElementById("mesaj-kutusu");
            mesajKutusu.textContent = message;
            mesajKutusu.className = "mesaj-kutusu"; // Önceki sınıfları temizle
            if (isError) {
                mesajKutusu.classList.add("hata");
            } else {
                mesajKutusu.classList.add("basari");
            }
            mesajKutusu.style.display = "block";

            // 5 saniye sonra mesajı gizle
            setTimeout(() => {
                mesajKutusu.style.display = "none";
            }, 5000);
        }

        // Tüm verileri API'den çekip listeleri güncelleyen ana fonksiyon
        async function yukleVeGoster() {
            try {
                // Ana Sayfa Metni Yükle
                const anasayfaRes = await fetch(`${API_BASE_URL}/api/anasayfa`);
                if (!anasayfaRes.ok) throw new Error('Ana sayfa metni yüklenemedi.');
                const anasayfaData = await anasayfaRes.json();
                document.getElementById('anasayfa-metin').value = anasayfaData.metin || '';

                // Duyuruları Yükle
                const duyurularRes = await fetch(`${API_BASE_URL}/api/duyurular`);
                if (!duyurularRes.ok) throw new Error('Duyurular yüklenemedi.');
                const duyurular = await duyurularRes.json();
                const duyuruListesi = document.getElementById("duyuru-listesi");
                duyuruListesi.innerHTML = ""; // Listeyi temizle
                if (Array.isArray(duyurular)) {
                    duyurular.forEach((duyuru) => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                            <span>
                                <strong>${duyuru.baslik}</strong> (${duyuru.tarih})<br>
                                <small>${duyuru.detay.substring(0, 70)}${duyuru.detay.length > 70 ? '...' : ''}</small>
                            </span>
                            <button class="sil-buton" onclick="duyuruSil('${duyuru._id}')">Sil</button>
                        `;
                        duyuruListesi.appendChild(li);
                    });
                }

                // Projeleri Yükle
                const projelerRes = await fetch(`${API_BASE_URL}/api/projeler`);
                if (!projelerRes.ok) throw new Error('Projeler yüklenemedi.');
                const projeler = await projelerRes.json();
                const projeListesi = document.getElementById("proje-listesi");
                projeListesi.innerHTML = ""; // Listeyi temizle
                if (Array.isArray(projeler)) {
                    projeler.forEach((proje) => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                            <span>
                                <strong>${proje.baslik}</strong> (${proje.tur})<br>
                                <small>${proje.detay.substring(0, 70)}${proje.detay.length > 70 ? '...' : ''}</small>
                                ${proje.basvuruLink ? `<br><small>Başvuru: <a href="${proje.basvuruLink}" target="_blank">${proje.basvuruLink.substring(0, 40)}...</a></small>` : ''}
                            </span>
                            <button class="sil-buton" onclick="projeSil('${proje._id}')">Sil</button>
                        `;
                        projeListesi.appendChild(li);
                    });
                }

                // Görselleri Yükle
                const gorsellerRes = await fetch(`${API_BASE_URL}/api/galeri`);
                if (!gorsellerRes.ok) throw new Error('Görseller yüklenemedi.');
                const gorseller = await gorsellerRes.json();
                const galeriListesi = document.getElementById("galeri-listesi");
                galeriListesi.innerHTML = ""; // Listeyi temizle
                if (Array.isArray(gorseller)) {
                    gorseller.forEach((gorsel) => {
                        const li = document.createElement("li");
                        const aciklamaSnippet = gorsel.aciklama ? (gorsel.aciklama.substring(0, 50) + (gorsel.aciklama.length > 50 ? '...' : '')) : 'Açıklama yok';
                        li.innerHTML = `
                            <span title="${gorsel.aciklama || ''}">
                                <img src="${gorsel.url}" alt="Galeri Görseli">
                                ${gorsel.url}<br>
                                <small>Açıklama: ${aciklamaSnippet}</small>
                            </span>
                            <button class="sil-buton" onclick="gorselSil('${gorsel._id}')">Sil</button>
                        `;
                        galeriListesi.appendChild(li);
                    });
                }

            } catch (err) {
                console.error("Veriler yüklenirken bir hata oluştu:", err);
                showMessage(`Veriler yüklenirken bir hata oluştu: ${err.message}`, true);
            }
        }

        // --- Ekleme Fonksiyonları ---

        async function anasayfaMetniGuncelle() {
            const metin = document.getElementById("anasayfa-metin").value;
            try {
                const response = await fetch(`${API_BASE_URL}/api/anasayfa`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ metin })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Ana sayfa metni güncellenirken bir hata oluştu.');
                }
                showMessage("Ana sayfa metni başarıyla güncellendi!");
                yukleVeGoster();
            } catch (error) {
                console.error("Ana sayfa metni güncelleme hatası:", error);
                showMessage(`Metin güncellenirken hata: ${error.message}`, true);
            }
        }

        async function duyuruEkle() {
            const baslik = document.getElementById("duyuru-baslik").value;
            const tarih = document.getElementById("duyuru-tarih").value;
            const detay = document.getElementById("duyuru-detay").value;

            try {
                const response = await fetch(`${API_BASE_URL}/api/duyurular`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ baslik, tarih, detay })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Duyuru eklenirken bir hata oluştu.');
                }
                showMessage("Duyuru başarıyla eklendi!");
                document.getElementById("duyuru-baslik").value = "";
                document.getElementById("duyuru-tarih").value = "";
                document.getElementById("duyuru-detay").value = "";
                yukleVeGoster(); // Listeyi güncelle
            } catch (error) {
                console.error("Duyuru ekleme hatası:", error);
                showMessage(`Duyuru eklenirken hata: ${error.message}`, true);
            }
        }

        async function projeEkle() {
            const baslik = document.getElementById("proje-baslik").value;
            const detay = document.getElementById("proje-detay").value;
            const tur = document.getElementById("proje-tur").value;
            const basvuruLink = document.getElementById("proje-basvuru-link").value;

            try {
                const response = await fetch(`${API_BASE_URL}/api/projeler`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ baslik, detay, tur, basvuruLink })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Proje eklenirken bir hata oluştu.');
                }
                showMessage("Proje başarıyla eklendi!");
                document.getElementById("proje-baslik").value = "";
                document.getElementById("proje-detay").value = "";
                document.getElementById("proje-tur").value = "devam";
                document.getElementById("proje-basvuru-link").value = "";
                yukleVeGoster(); // Listeyi güncelle
            } catch (error) {
                console.error("Proje ekleme hatası:", error);
                showMessage(`Proje eklenirken hata: ${error.message}`, true);
            }
        }

        async function gorselEkle() {
            const url = document.getElementById("gorsel-url").value;
            const aciklama = document.getElementById("gorsel-aciklama").value;

            try {
                const response = await fetch(`${API_BASE_URL}/api/galeri`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, aciklama })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Görsel eklenirken bir hata oluştu.');
                }
                showMessage("Görsel başarıyla eklendi!");
                document.getElementById("gorsel-url").value = "";
                document.getElementById("gorsel-aciklama").value = "";
                yukleVeGoster(); // Listeyi güncelle
            } catch (error) {
                console.error("Görsel ekleme hatası:", error);
                showMessage(`Görsel eklenirken hata: ${error.message}`, true);
            }
        }

        // --- Silme Fonksiyonları ---

        async function duyuruSil(id) {
            if (!confirm("Bu duyuruyu silmek istediğinizden emin misiniz?")) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/api/duyurular/${id}`, {
                    method: 'DELETE',
                });
                const data = await response.json();
                if (!response.ok) {
                    // API'den gelen hata mesajını kullan
                    throw new Error(data.error || 'Duyuru silinirken bilinmeyen bir hata oluştu.');
                }
                showMessage("Duyuru başarıyla silindi!");
                yukleVeGoster(); // Listeyi yeniden yükle
            } catch (error) {
                console.error("Duyuru silme hatası:", error);
                showMessage(`Duyuru silinirken hata: ${error.message}`, true);
            }
        }

        async function projeSil(id) {
            if (!confirm("Bu projeyi silmek istediğinizden emin misiniz?")) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/api/projeler/${id}`, {
                    method: 'DELETE',
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Proje silinirken bilinmeyen bir hata oluştu.');
                }
                showMessage("Proje başarıyla silindi!");
                yukleVeGoster(); // Listeyi yeniden yükle
            } catch (error) {
                console.error("Proje silme hatası:", error);
                showMessage(`Proje silinirken hata: ${error.message}`, true);
            }
        }

        async function gorselSil(id) {
            if (!confirm("Bu görseli silmek istediğinizden emin misiniz?")) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/api/galeri/${id}`, {
                    method: 'DELETE',
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Görsel silinirken bilinmeyen bir hata oluştu.');
                }
                showMessage("Görsel başarıyla silindi!");
                yukleVeGoster(); // Listeyi yeniden yükle
            } catch (error) {
                console.error("Görsel silme hatası:", error);
                showMessage(`Görsel silinirken hata: ${error.message}`, true);
            }
        }

        // Sayfa yüklendiğinde verileri çek ve göster
        window.onload = yukleVeGoster;
    </script>
</body>

</html>